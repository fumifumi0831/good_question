# ストレージ戦略: ハイブリッド方式 (Local-first) の採用

## 1. 概要
本プロジェクトでは、最高品質のユーザー体験 (UX) とマルチデバイス間でのデータ同期を両立するため、「ハイブリッド方式 (Local-first)」を採用する。

## 2. なぜハイブリッド方式なのか（クラウドのみとの比較）

| 比較項目 | クラウドのみ (Supabaseのみ) | ハイブリッド (Local-first) |
| :--- | :--- | :--- |
| **応答速度** | 通信が発生するため、常に待機が発生。 | **ゼロレイテンシ**。一瞬で反応。 |
| **オフライン** | 不可。 | **可能**。通信がなくてもプレイ可能。 |
| **オンボーディング** | **ログイン必須**。 | **ログイン不要**で即プレイ開始。 |
| **UX品質** | ロード中が多く、Webアプリ感が強い。 | **ネイティブアプリに近い**サクサク感。 |

## 3. 具体的な実装構造

### A. ローカルレイヤー (IndexedDB / LocalStorage)
- **役割**: UIへの即時反映、オフライン時のデータ保持。
- **LocalStorage**: 軽量な統計データ（XP、レベル、現在のストリーク）。
- **IndexedDB (Dexie.js)**: 大容量の会話履歴、詳細な解析ログ。

### B. クラウドレイヤー (Supabase)
- **役割**: バックアップ、マルチデバイス（PC/スマホ）間の同期。
- **同期のタイミング**: 
  - ログイン時（ローカルデータのアップロード）
  - セッション終了時（バックグラウンドでの保存）

## 4. ユーザーメリット
- **摩擦ゼロの開始**: アカウントを作らなくても、最初の1問を解き、結果を保存できる。
- **ストレスフリーな操作**: 質問を送るたびに「待ち」が発生しない。
- **いつでも、どこでも**: 電波の悪い場所でスマホで練習し、後でPCからじっくり振り返ることができる。
