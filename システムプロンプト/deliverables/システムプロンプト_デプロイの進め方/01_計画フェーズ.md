# 計画フェーズ（フェーズ 1-3）

## 目的

CI/CD パイプラインの設計と計画を立てる。デプロイ要件を明確化し、CI/CD パイプラインを設計し、ローカル検証方法を設計する。

---

## フェーズ 1: デプロイ要件の明確化

### 目的

デプロイ先、デプロイ方式、環境変数などの要件を明確化する。

### 確認項目

1. **アプリケーション構成**

   - フロントエンド: フレームワーク（React、Vue、Next.js など）、ビルドツール（Vite、Webpack など）
   - バックエンド: 言語（Python、Node.js、Go など）、フレームワーク（FastAPI、Express、Gin など）
   - データベース: データベースの種類と接続方法

2. **デプロイ先**

   - クラウドプロバイダー: Azure、AWS、GCP など
   - サービス: App Service、Elastic Beanstalk、Cloud Run など
   - 環境: 開発環境、ステージング環境、本番環境

3. **デプロイ方式**

   - ZIP デプロイ: Azure App Service、AWS Elastic Beanstalk など
   - Docker デプロイ: Docker コンテナとしてデプロイ
   - GitHub Actions: GitHub Actions を使用した CI/CD
   - Azure Pipelines: Azure DevOps を使用した CI/CD
   - その他: その他のデプロイ方式

4. **環境変数**

   - フロントエンド: ビルド時に必要な環境変数（`VITE_*`など）
   - バックエンド: 実行時に必要な環境変数（API キー、データベース接続文字列など）

5. **その他の要件**
   - ビルド時間の制約
   - デプロイ時間の制約
   - セキュリティ要件
   - コスト要件

### 出力

- **デプロイ要件ドキュメント**: 上記の確認項目をまとめたドキュメント

### 確認方法

- デプロイ要件が明確になっているか
- 不足している要件がないか
- 矛盾する要件がないか

---

## フェーズ 2: CI/CD パイプラインの設計

### 目的

各ステップ（ビルド、テスト、デプロイ）を設計する。

### 設計項目

1. **CI/CD パイプラインの各ステップ**

   - **ステップ 1: ソースコードの取得**
     - リポジトリから最新のコードを取得
     - ブランチやコミットの情報を取得
   - **ステップ 2: 依存関係のインストール**
     - フロントエンド: `npm ci`, `yarn install`など
     - バックエンド: `pip install -r requirements.txt`, `npm install`など
   - **ステップ 3: ビルド**
     - フロントエンド: `npm run build`, `yarn build`など
     - バックエンド: 必要に応じてビルド（Python の場合は通常不要）
   - **ステップ 4: テスト（オプション）**
     - ユニットテスト、統合テストの実行
   - **ステップ 5: 成果物の準備**
     - ZIP デプロイ: ZIP ファイルの作成
     - Docker デプロイ: Docker イメージのビルド
     - その他: デプロイ方式に応じた成果物の準備
   - **ステップ 6: デプロイ**
     - 成果物をデプロイ先にデプロイ
     - 環境変数の設定
     - アプリケーションの起動

2. **各ステップの入出力**

   - **入力**: 各ステップで必要な入力（ソースコード、依存関係、環境変数など）
   - **出力**: 各ステップで生成される出力（ビルド成果物、ZIP ファイル、Docker イメージなど）
   - **成功条件**: 各ステップが成功したと判断する条件

3. **エラーハンドリング**

   - 各ステップでエラーが発生した場合の対処方法
   - ログ出力の方法
   - 通知方法

### 出力

- **CI/CD パイプライン設計書**: 上記の設計項目をまとめたドキュメント

### 確認方法

- 各ステップが明確になっているか
- 各ステップの入出力が明確になっているか
- エラーハンドリングが適切か

---

## フェーズ 3: ローカル検証方法の設計

### 目的

クラウド上では見えにくいパイプラインをローカルで再現する方法を設計する。

### 設計項目

1. **ローカル検証の目的**

   - **可視化**: 各ステップで何が起きているかを目で確認できる
   - **デバッグの容易さ**: エラーが発生した場合、すぐに原因を特定できる
   - **理解の深化**: 各ステップを実際に実行することで、CI/CD パイプラインの動作を深く理解できる
   - **学習効果**: クラウド上で「動かない」だけでは学習にならないが、ローカルで再現することで学習になる

2. **ローカル検証スクリプトの設計**

   - **検証項目の分割**: 各ステップを独立した検証項目に分割
     - 例: ZIP デプロイの場合
       - 検証項目 1: ZIP 作成プロセスの検証
       - 検証項目 2: ZIP ファイルの内容確認
       - 検証項目 3: 静的ファイル配信の検証
       - 検証項目 4: 環境変数の設定確認
   - **各検証項目の独立性**: 1 つずつ実行できるように設計
   - **エラーハンドリング**: エラーが発生した場合の対処方法
   - **ログ出力**: 検証結果を分かりやすく出力

3. **ローカル検証の実行環境**

   - **必要なツール**: Node.js、Python、Docker など
   - **環境変数の設定**: ローカル検証用の環境変数
   - **実行方法**: スクリプトの実行方法

### 出力

- **ローカル検証方法の設計書**: 上記の設計項目をまとめたドキュメント

### 確認方法

- ローカル検証の目的が明確になっているか
- 検証項目が適切に分割されているか
- 各検証項目が独立して実行できるか
- エラーハンドリングが適切か

---

## フェーズの進め方

### ステップ 1: デプロイ要件の明確化

1. アプリケーション構成を確認
2. デプロイ先を確認
3. デプロイ方式を選択
4. 環境変数を確認
5. その他の要件を確認
6. デプロイ要件ドキュメントを作成

### ステップ 2: CI/CD パイプラインの設計

1. 各ステップを設計
2. 各ステップの入出力を明確化
3. エラーハンドリングを設計
4. CI/CD パイプライン設計書を作成

### ステップ 3: ローカル検証方法の設計

1. ローカル検証の目的を明確化
2. 検証項目を分割
3. 各検証項目の独立性を確認
4. エラーハンドリングを設計
5. ローカル検証方法の設計書を作成

---

## 完了基準の確認

**学習者主導の要件充足度評価**:

- [ ] デプロイ要件が明確になっているか
- [ ] CI/CD パイプラインの各ステップが明確になっているか
- [ ] 各ステップの入出力が明確になっているか
- [ ] ローカル検証方法が設計されているか
- [ ] 検証項目が適切に分割されているか

**❓ 「この計画フェーズで十分ですか？修正・追加したい部分はありますか？」**
