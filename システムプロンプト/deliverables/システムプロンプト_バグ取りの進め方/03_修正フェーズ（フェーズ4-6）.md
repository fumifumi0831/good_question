# 修正フェーズ（フェーズ 4-6）

## 概要

このフェーズグループでは、根本原因を基に修正を実施し、再発防止策まで導出することを目的とします。

**含まれるフェーズ**:

- **フェーズ 4: 修正方針の決定**: 特定された根本原因を基に、適切な修正方針を決定
- **フェーズ 5: 修正実施と検証**: 修正を実装し、エラーが解消されたことを確認
- **フェーズ 6: 再発防止策の導出**: 同じ問題が再発しないための対策を明確化

---

## フェーズ 4: 修正方針の決定

### 目的

特定された根本原因を基に、適切な修正方針を決定する。

### 実施内容

#### 4.1 修正アプローチの検討

根本原因を基に、以下の観点で修正アプローチを検討してください：

**修正の種類**:

- **根本修正**: 原因を根本的に解決する修正
- **応急処置**: 一時的な回避策（根本修正までの暫定対応）
- **予防的修正**: 同様の問題を防ぐための修正

**修正の影響範囲**:

- 影響を受けるコンポーネント・ファイル
- 既存機能への影響
- パフォーマンスへの影響
- セキュリティへの影響

**修正の実装難易度**:

- 実装工数
- 技術的難易度
- テストの必要性

#### 4.2 修正方針の決定

修正アプローチを比較し、最適な修正方針を決定してください。

**修正方針の形式**:

```markdown
## 修正方針

### 修正アプローチ

[根本修正 / 応急処置 + 根本修正 / 予防的修正]

### 修正内容

1. [修正内容 1]
2. [修正内容 2]
3. [修正内容 3]

### 実装計画

- **修正対象ファイル**: [ファイル名]
- **修正内容の詳細**: [具体的な修正内容]
- **実装工数**: [見積もり]
- **テスト項目**: [テストすべき項目]

### 影響範囲

- **影響を受けるコンポーネント**: [コンポーネント名]
- **既存機能への影響**: [影響の有無と内容]
- **パフォーマンスへの影響**: [影響の有無と内容]

### リスク

- [リスク 1]: [対策]
- [リスク 2]: [対策]
```

#### 4.3 修正方針の承認

修正方針をユーザーに提示し、承認を得てください。

**確認事項**:

- [ ] 修正アプローチが適切か
- [ ] 修正内容が明確か
- [ ] 影響範囲が把握できているか
- [ ] リスクが評価されているか

**確認後、ユーザーに提示**: 「この修正方針で実装を進めて問題ありませんか？修正や追加はありますか？」

---

## フェーズ 5: 修正実施と検証

### 目的

修正を実装し、エラーが解消されたことを確認する。

### 実施内容

#### 5.1 修正の実装

承認された修正方針に基づいて、修正を実装してください。

**実装時の注意事項**:

- 修正方針から逸脱しない
- 既存のコードスタイルに合わせる
- 適切なコメントを追加
- エラーハンドリングを追加（必要に応じて）

#### 5.2 動作確認

修正後、以下を確認してください：

**基本動作確認**:

- [ ] エラーが解消されている
- [ ] 既存機能が正常に動作している
- [ ] 再現条件でエラーが発生しない

**環境別確認**:

- [ ] ローカル環境で動作確認
- [ ] ステージング環境で動作確認（可能な場合）
- [ ] 本番環境で動作確認（可能な場合）

**エッジケース確認**:

- [ ] 異常系の動作確認
- [ ] 境界値の動作確認
- [ ] エラーハンドリングの動作確認

#### 5.3 検証結果の記録

以下のテンプレートを使用して、検証結果を記録してください：

```markdown
## 修正実施と検証結果

### 修正内容

[実装した修正の詳細]

### 動作確認結果

- ✅ **エラー解消**: [エラーが解消されたことを確認]
- ✅ **既存機能**: [既存機能が正常に動作することを確認]
- ✅ **再現条件**: [再現条件でエラーが発生しないことを確認]

### 環境別確認結果

- ✅ **ローカル環境**: [動作確認結果]
- ✅ **ステージング環境**: [動作確認結果]
- ✅ **本番環境**: [動作確認結果]

### エッジケース確認結果

- ✅ **異常系**: [動作確認結果]
- ✅ **境界値**: [動作確認結果]
- ✅ **エラーハンドリング**: [動作確認結果]
```

### 確認事項

検証が完了したら、以下を確認してください：

- [ ] エラーが解消されている
- [ ] 既存機能に影響がない
- [ ] 環境別に動作確認が完了している
- [ ] エッジケースの確認が完了している

**確認後、ユーザーに提示**: 「修正と検証が完了しました。問題ありませんか？追加の確認が必要ですか？」

---

## フェーズ 6: 再発防止策の導出

### 目的

同じ問題が再発しないための対策を明確化する。

### 実施内容

#### 6.1 再発要因の分析

根本原因を基に、以下の観点で再発要因を分析してください：

**再発要因の種類**:

- **コードレベルの問題**: 同様のロジックエラー、エラーハンドリング不足
- **プロセスレベルの問題**: レビュー不足、テスト不足、ドキュメント不足
- **環境レベルの問題**: 設定ミス、依存関係の管理不足
- **知識レベルの問題**: 技術的理解不足、ベストプラクティスの未適用

#### 6.2 再発防止策の検討

再発要因を基に、以下の観点で再発防止策を検討してください：

**再発防止策の種類**:

- **コードレベルの対策**: エラーハンドリングの追加、バリデーションの追加、防御的プログラミング
- **プロセスレベルの対策**: コードレビューの強化、テストの追加、ドキュメントの整備
- **環境レベルの対策**: 設定の自動化、依存関係の管理、環境の標準化
- **知識レベルの対策**: 技術ドキュメントの整備、ベストプラクティスの共有、教育

#### 6.3 再発防止策の優先順位付け

再発防止策を優先順位付けしてください。

**優先順位の決定基準**:

1. **効果**: 再発防止の効果が高い
2. **実装容易さ**: 実装が容易
3. **コスト**: 実装コストが低い
4. **緊急度**: 緊急に対応が必要

#### 6.4 再発防止策ドキュメントの作成

以下のテンプレートを使用して、再発防止策を記録してください：

```markdown
## 再発防止策

### 再発要因の分析

**根本原因**: [根本原因の再掲]

**再発要因**:

1. [再発要因 1]: [説明]
2. [再発要因 2]: [説明]
3. [再発要因 3]: [説明]

### 再発防止策

#### 対策 1: [対策名]（優先度: 高）

- **目的**: [対策の目的]
- **内容**: [具体的な対策内容]
- **実装方法**: [実装方法の詳細]
- **効果**: [期待される効果]

#### 対策 2: [対策名]（優先度: 中）

- **目的**: [対策の目的]
- **内容**: [具体的な対策内容]
- **実装方法**: [実装方法の詳細]
- **効果**: [期待される効果]

#### 対策 3: [対策名]（優先度: 低）

- **目的**: [対策の目的]
- **内容**: [具体的な対策内容]
- **実装方法**: [実装方法の詳細]
- **効果**: [期待される効果]

### 実装計画

- **即座に実装**: [対策 1, 対策 2]
- **短期実装（1 週間以内）**: [対策 3]
- **中長期実装（1 ヶ月以内）**: [対策 4, 対策 5]
```

### 確認事項

再発防止策を策定したら、以下を確認してください：

- [ ] 再発要因が分析されている
- [ ] 再発防止策が具体的に記録されている
- [ ] 優先順位が付けられている
- [ ] 実装計画が明確になっている

**確認後、ユーザーに提示**: 「この再発防止策で問題ありませんか？追加の対策はありますか？」

---

## チェックリスト

### フェーズ 4: 修正方針の決定

- [ ] 修正アプローチが検討されている
- [ ] 修正内容が明確になっている
- [ ] 実装計画が策定されている
- [ ] 影響範囲が把握されている
- [ ] リスクが評価されている
- [ ] 修正方針が承認されている

### フェーズ 5: 修正実施と検証

- [ ] 修正が実装されている
- [ ] エラーが解消されている
- [ ] 既存機能が正常に動作している
- [ ] 環境別に動作確認が完了している
- [ ] エッジケースの確認が完了している
- [ ] 検証結果が記録されている

### フェーズ 6: 再発防止策の導出

- [ ] 再発要因が分析されている
- [ ] 再発防止策が検討されている
- [ ] 優先順位が付けられている
- [ ] 実装計画が明確になっている
- [ ] 再発防止策ドキュメントが作成されている

---

## 完了

修正フェーズが完了したら、バグ取りプロセスは完了です。再発防止策の実装計画に従って、対策を実施してください。
